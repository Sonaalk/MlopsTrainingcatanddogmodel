- name: Deploy to Kubernetes
  run: |
    kubectl apply -f k8s/deployment.yaml
    kubectl apply -f k8s/service.yaml
    kubectl rollout status deployment/cats-dogs-deployment --timeout=180s

- name: Run in-cluster smoke test
  run: |
    kubectl delete job cats-dogs-smoke-test --ignore-not-found
    kubectl apply -f k8s/smoke-test-job.yaml
    kubectl wait --for=condition=complete job/cats-dogs-smoke-test --timeout=120s